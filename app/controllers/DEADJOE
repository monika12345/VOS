
*** These modified files were found in JOE when it aborted on Mon Apr  6 01:03:45 2015
*** JOE was aborted because the terminal closed

*** File 'users_controller.rb'
class UsersController < ApplicationController
before_action :logged_in_user, only: [:index, :edit, :update, :destroy]
before_action :correct_user, only: [:edit, :update]
before_action :admin_user,  only: :destroy

   def show
       @user = User.find(params[:id])
   end


 def index
    @users = User.paginate(page: params[:page])
 end


 
   def destroy
       User.find(params[:id]).destroy
       flash[:success] = "User deleted"
       redirect_to users_url
  end
                 
 def user_params
       params.require(:user).permit(:name, :email, :password,
                                          :password_confirmation)
 end                
                 

  def new
     @user = User.new
  end
  

  def create
      @user = User.new(user_params)
      if @user.save
        log_in @user
        flash[:success] = "Welcome to the Sample App!"
        redirect_to @user
      else
       render 'new'
       end
      end

   def edit 
     @user = User.find(params[:id])
   end 
   
   def update
     @user = User.find(params[:id])
     if @user.update_attributes(user_params)
        flash[:success] = "Profile update"
        redirect_to @user     
     else
        render 'edit'
     end
   end
   
   
   
   
    private
    
       
  def admin_user
     redirect_to(root_url) unless current_user.admin?
  end
      
  
    
  def logged_in_user
      unless logged_in?
      store_location
      flash[:danger] = "Please log in."
      redirect_to login_url
    end
  end
  
  
  #Confirm the correct user
  def correct_user
      @user = User.find(params[:id])
      redirect_to(root_url) unless current_user?(@user)
   end
end



*** File '(Unnamed)'
registration.html.erb
new.html.erb
new.html.erb
new.html.erb
new.html.erb
services/
new.html.erb
new.html.erb
static_pages_controller.rb
static_pages_controller.rb
users_controller.rb

*** These modified files were found in JOE when it aborted on Thu Apr  9 21:46:53 2015
*** JOE was aborted because the terminal closed

*** File 'parking_places_controller.rb'
class ParkingPlacesController < ApplicationController
 before_action :logged_in_user, only: [:create, :destroy]  

  def new 
    @parking_place = ParkingPlace.new
  end

  def show
    @parking_place = ParkingPlace.find(params[:id])
    @user = User.find(@parking_place.user_id)
   
  end
  
  def index
    @parking_places= ParkingPlace.all
    @parking_places = ParkingPlace.paginate(page: params[:page])
  end
  
  def create
      @parking_place = current_user.parking_places.build(parking_places_params)
      if @parking_place.save
            flash[:success] = "Parkovacie miesto vytvorene"
            redirect_to root_url
       else
          render 'static_pages/login'
       end
   end


def destroy
end

 private
 
 def parking_places_params
  
   params.require(:parking_place).permit(:spz)
 end
end 
*** File '(Unnamed)'
park
parking_place.rb
parking_place.rb
parking_place.rb
parking_place.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_place.rb
user.rb
parking_places_controller.rb

*** These modified files were found in JOE when it aborted on Fri Apr 10 15:39:53 2015
*** JOE was aborted because the terminal closed

*** File '(Unnamed)'
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
users_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb

*** These modified files were found in JOE when it aborted on Fri Apr 10 15:40:19 2015
*** JOE was aborted because the terminal closed

*** File '(Unnamed)'
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
parking_places_controller.rb
users_controller.rb
users_controller.rb
users_controller.rb
users_controller.rb
users_controller.rb
users_controller.rb

*** These modified files were found in JOE when it aborted on Tue Apr 28 11:00:43 2015
*** JOE was aborted by UNIX signal 1

*** File 'parking_places_controller.rb'
class ParkingPlacesController < ApplicationController
 before_action :logged_in_user, only: [:create, :destroy]  

  def new 
    @parking_place = ParkingPlace.new
  end

  def show
    @parking_place = ParkingPlace.find(params[:id])
    @user = User.find(@parking_place.user_id)
   
  end

 def search
   @parking_places = ParkingPlace.search params[:search]
 end

  def index

   # @pocet= ParkingPlace.fin_by_sql( "SELECT  Count(*) FROM parking_places p JOIN users u  ON u.id = p.user_id GROUP BY p.ulica LIMIT(1))")
   # connection = ActiveRecord::Base.connection
   # connection.execute(q).first
    # @parking_place = ParkingPlace.search(params[:search])
    #@parking_place = ParkingPlace.find_by(params[:spz])
    #redirect_to root_url
    @parking_places= ParkingPlace.all
    @parking_places = ParkingPlace.paginate(page: params[:page])
    @pocet = pocetuz
    @mestaa = mesta
  end
  
  def create
        @parking_place = current_user.parking_places.build(parking_places_params)
      
      # @idcko= current_user.id
       #4.1 query = "INSERT INTO parking_places (user_id, spz, ulica, location_id, created_at, updated_at) VALUES ( #{@idcko} ,  '#{params[:parking_place][:spz]}' , '#{params[:parking_place][:ulica]}' , #{params[:parking_place][:location_id]}, (now()), (now()))"     
    # @parking_place = current_user.parking_places.build(parking_places_params)
    # connection = ActiveRecord::Base.connection
      #  @parking_place = connection.execute(query)
      
      if @parking_place.save
           flash[:success] = "Parkovacie miesto vytvorene"
          redirect_to root_url
      else
          render 'static_pages/login'
       end
   end


def destroy
end

 private

 def pocetuz
   query = "SELECT p.ulica , Count(*) as count FROM parking_places p JOIN users u  ON u.id = p.user_id GROUP BY p.ulica"
   connection = ActiveRecord::Base.connection
   connection.execute(query)
 end

 def mesta

     query = "SELECT  l.city, Count(*) as count FROM parking_places p JOIN locations l ON l.id = p.location_id GROUP BY l.city"
     connection = ActiveRecord::Base.connection
     connection.execute(query)

 end

 def parking_places_params

   params.require(:parking_place).permit(:spz, :ulica, :location_id)
 end
end 
*** File '(Unnamed)'
Zadanie2.rb
Zadanie2.rb
Zadanie2.rb
Zadanie2.rb
Zadanie2.rb
Zadanie2.rb
Zadanie2.rb
Zadanie2.rb
Zadanie2.rb
users_controller.rb
parking_places_controller.rb
